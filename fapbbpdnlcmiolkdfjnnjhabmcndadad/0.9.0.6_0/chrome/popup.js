function setTimeagoLocale(){var a;try{a=JSON.parse(localStorage.acceptedLanguages)}catch(b){a=[navigator.language]}a=a||[];a=(a).concat(a.filter(function(c){return c.indexOf("-")!=-1}).map(function(c){return c.split("-")[0]}).filter(function(c){return a.indexOf(a)==-1}));a.some(function(c){if(c in jQuery.timeago.settings.locales){jQuery.timeago.settings.strings=jQuery.timeago.settings.locales[c];return true}return false})}setTimeagoLocale();chrome.i18n.getAcceptLanguages(function(a){localStorage.acceptedLanguages=JSON.stringify(a);setTimeagoLocale()});function startLoading(){$(document.body).addClass("loading")}function stopLoading(){$(document.body).removeClass("loading")}function showWebcams(b){function a(c){var d=Formater.getWebcam(c);$("#webcams-container",document).jsTemplate(d);Carousel.update()}if(!chrome.settings.get("debug")&&chrome.settings.get("webcams.place.city")==b.city){a(chrome.settings.get("webcams"))}else{$.ajax({mathod:"get",url:"http://api.webcams.travel/rest?method=wct.webcams.list_nearby&devid=4fb2b6cc7e11d1b9bf75944b30ee0735&format=json",dataType:"json",data:{lat:b.location.latitude,lng:b.location.longitude},success:function(c){c.place=b;chrome.settings.set("webcams",c);a(chrome.settings.get("webcams"))}})}}function fillForecast(b){var a=$.extend(b,{current:Formater.getWeather(b.current),forecast:b.forecast.sort(function(d,c){return new Date(d.date)-new Date(c.date)}).map(function(c){return Formater.getWeather(c)})});$("#forecast",document).jsTemplate(a).show().siblings().hide()}function showForecast(a,b){Weather.getForecast(a,function(c){if(c){fillForecast($.extend({},a,c));showWebcams(a);Weather.updateBrowserAction(a,c.current);c.reference=a.reference;chrome.settings.set("weather",c);b&&b(c)}b&&b(c)})}function showBookmarks(){$("#bookmarks",document).jsTemplate({place:chrome.settings.get("bookmarks")||[]}).show().siblings().hide()}function setUnit(){$("input[name=unit][value="+chrome.settings.get("unit")+"]",document).each(function(){this.checked=true});if(chrome.settings.get("favorite")){chrome.extension.sendRequest("update")}}document.addEventListener("DOMContentLoaded",function(){chrome.i18n.process(document);$("#select-provider").change(function(d){chrome.settings.set("provider",$(this).val());Weather.selectAPI($(this).val());Carousel.pause();showForecast(chrome.settings.get("favorite"),function(){Carousel.start()})}).val(chrome.settings.get("provider"));$("input[name=notifications]").change(function(){chrome.settings.set("notification.forecast",this.checked);chrome.settings.set("notification.present",this.checked)}).each(function(){this.checked=chrome.settings.get("notification.forecast")||chrome.settings.get("notification.present")});$("input[name=unit]",document).change(function(){chrome.settings.set("unit",$(this).val());showForecast(chrome.settings.get("favorite"))}).filter("[value="+chrome.settings.get("unit")+"]").each(function(){this.checked=true});var a=$("form[name=placesearch]",document);a.submit(function(){var d=$(this);startLoading();places.search(d.find("input[name=query]").val(),function(e){stopLoading();if(e&&e.length>0){$("#results",document).jsTemplate({place:e}).show().siblings().hide();$("#results",document).find("input[name=bookmark][type=checkbox]").change(function(){if(this.checked){Bookmark.add(this.data)}else{Bookmark.remove(this.data)}})}else{$("#no-results",document).show().siblings().hide()}});return false});var c;a.find("input[name=query]",document).keyup(function(e){if(chrome.settings.get("autocomplete.active")){var d=$(this).val();clearTimeout(c);if(d.length>2){c=setTimeout(function(){a.submit()},chrome.settings.get("autocomplete.timeout"))}}});$("#bookmarks",document).change(function(g){var e=g.target;var d=$(e);var f=e.data.code;if(d.is("[name=bookmark]")){Bookmark.remove(e.data);showBookmarks()}});$("[name=place]>a",document).live("click",function(){var d=this.data;if(!("woeid" in d)){$("input[name=query]").val(d.city);return a.submit()}chrome.settings.set("favorite",d);startLoading();showForecast(d,stopLoading);return false});$("a[rel=bookmarks]",document).click(showBookmarks);$("a[rel=webcamzoom]",document).live("mouseenter",function(){var d=$(this).closest("[name=item]").data("webcam");$("#webcamzoom-container").show().find("img").attr("src",(d.thumbnail||"").replace("thumbnail","webcam"))}).live("mouseleave",function(){$("#webcamzoom-container").hide()});Carousel.init($("#webcams-container").get(0));if(chrome.settings.has("favorite")&&chrome.settings.get("favorite.woeid")){startLoading();if(chrome.settings.has("weather")&&chrome.settings.has("favorite")){fillForecast($.extend({},chrome.settings.get("favorite"),chrome.settings.get("weather")))}window.setTimeout(function(){showForecast(chrome.settings.get("favorite"),function(){stopLoading();Carousel.start()})},10)}if(chrome.settings.get("social.active")){const b=chrome.extension.getBackgroundPage();b.FBConnect(document.getElementById("fb-connect-container"),chrome.settings.get("api.facebook"))}},false);var places=Places($.extend({language:chrome.settings.get("language")},chrome.settings.get("api.geoplanet")));