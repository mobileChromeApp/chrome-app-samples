var Dialog=Backbone.View.extend({events:{"click .item":"returnItem","click .close":"returnClose"},templateString:'<div style="opacity:0" class="dialog <%- className %>"><%= html %><ul><% _.each(items, function(item) { %> <li class="item" id="<%= item.id %>"><h2><%= item.name %></h2><span class="addendum">&nbsp;<%= item.addendum %></span><p><%= item.description %></p></li> <% }); %></ul></div>',initialize:function(b){if(_.isUndefined(b.el)){this.el=$("<div></div>");$("body").append(this.el);this.delegateEvents()}this.callback=b.callback;this.items=b.items;this.className=b.className;this.title=b.title;this.html=b.html;this.render()},returnItem:function(b){for(var c=0;c<this.items.length;c++){if(this.items[c].id==$(b).attr("id")){this.callback(this.items[c]);break}}this.remove();return true},returnClose:function(){this.callback(false);this.remove();return false},remove:function(){$(this.el).children().css("opacity",0);window.setTimeout(function(){$(this.el).remove()},500)},render:function(){var a=_.template(this.templateString,this);a=$(a);$(this.el).append(a);window.setTimeout(function(){a.css("opacity",1)},100);this.delegateEvents();var b=this;$(".close",this.el).click(function(){b.returnClose(this)});$(".item",this.el).click(function(){b.returnItem(this)});return this}});(function(c){var m=function(n){return n};var j=500;var k=false;var e=false;var i=false;function l(){var n=[{id:"one-suit",name:m("interface.games.one-suit.name"),addendum:m("interface.games.one-suit.addendum"),description:m("interface.games.one-suit.description"),options:{suits:1}},{id:"two-suit",name:m("interface.games.two-suit.name"),addendum:m("interface.games.two-suit.addendum"),description:m("interface.games.two-suit.description"),options:{suits:2}},{id:"four-suit",name:m("interface.games.four-suit.name"),addendum:m("interface.games.four-suit.addendum"),description:m("interface.games.four-suit.description"),options:{suits:3}}];var o=new Dialog({title:m("interface.name"),className:"gameChoose",items:n,html:"",callback:function(p){if(p==false){console.log("let's not play right now.")}else{k=p.options;d(k)}}})}function b(n){if(e){e.writeGameStats("lost",function(){});e=false}c("#gameboard,.dialog,.gamenumber").css("opacity",0);window.setTimeout(function(){c("#gameboard,.dialog").remove();c(".gamenumber").text("");n()},j*2);e=false;i=false;c("#toolbar").removeClass("gameactive")}function f(){if(!e){e=new SpiderGame()}e.getGameStats(function(p){var r=function(t,u,s){q+='<div class="'+t+'"><div class="title">'+u+'</div><div class="value">'+s+"</div></div>"};var q='<div class="column left"><h2 class="large" data-i18n="interface.scoreboard.scoreboard">Scoreboard</h2>';var n=p.regular.won.val+p.regular.lost.val;var o=Math.round((p.regular.won.val/n)*100);if(isNaN(o)){o=0}if(p.regular.won.streakLength){r("badgeblock winstreak",m("interface.scoreboard.winning-streak"),p.regular.won.streakLength)}if(p.regular.lost.streakLength){r("badgeblock losingstreak",m("interface.scoreboard.losing-streak"),p.regular.lost.streakLength)}r("badgeblock gamesplayed",m("interface.scoreboard.games-played"),n);r("badgeblock averagetime",m("interface.scoreboard.average-time"),e.getFormattedTime(p.regular.time.val));q+='<table><tbody><tr><th></th><th data-i18n="interface.scoreboard.total">Total</th><th data-i18n="interface.scoreboard.longest-streak">Longest Streak</th></tr><tr><th data-i18n="interface.scoreboard.won">Won</th><td>'+p.regular.won.val+"</td><td>"+p.regular.won.streakMax+'</td></tr><tr><th data-i18n="interface.scoreboard.lost">Lost</th><td>'+p.regular.lost.val+"</td><td>"+p.regular.lost.streakMax+"</td></tr></tbody></table>";q+='</div><div class="column right">';r("winpercent",m("interface.scoreboard.percentage-won"),o);q+="</div>";b(function(){var s=new Dialog({title:m("interface.scoreboard.scoreboard"),className:"scoreboard",items:[],html:q,callback:function(t){}});c(".dialog.scoreboard").i18n()})})}function a(o){var p=e.getTime("secs");var q=e.getScore();var n=e.getMoveCount();e.getBadges(function(t){e=false;var s="";for(var u=0;u<t.length;u++){s+='<div class="badgeholder"><div class="badge '+t[u].badge+'"></div><p>'+m("interface.badges."+t[u].badge,{val:t[u].val})+"</p></div>"}var r=[{name:m("interface.gameover.items.new-game.name"),id:"play-another",addendum:"",description:m("interface.gameover.items.new-game.description")},{name:m("interface.gameover.items.different-game.name"),id:"choose-another",addendum:"",description:m("interface.gameover.items.different-game.description")}];var v=o=="nomoves"?m("interface.gameover.no-moves"):m("interface.gameover.won");var w=i18n.t("interface.toolbar.moves",{moves:n})+" â€” "+i18n.t("interface.toolbar.score",{score:q});b(function(){var x=new Dialog({title:v,className:"gameComplete",items:r,html:'<h2 class="large center">'+v+'</h2><p class="minor selectable">'+w+"</p>"+s,callback:function(y){if(y==false){}else{if(y.id=="play-another"){delete k.seed;d(k)}else{l()}}}});c(".badgeholder").click(function(){f()})})})}function d(n){n=c.extend({seed:Math.round(Math.random()*1000000)},n);b(function(){var o=c('<div id="gameboard"></div>').css("opacity","0");c("body").append(o);e=new SpiderGame(n);i=new SpiderGameView({model:e,el:o[0],complete:function(p){window.setTimeout(function(){a(p)},j*4)}});window.view=i;window.model=e;c("#toolbar").addClass("gameactive");c("#gameboard").css("opacity","1");c(".gamenumber").css("opacity",".5")})}function h(){b(function(){var n=new Dialog({title:"About",className:"gameAbout",items:false,html:m("about"),callback:function(){}})})}function g(){b(function(){var n=new Dialog({title:"About",className:"gameRules",items:false,html:m("rules"),callback:function(){}})})}window.addEventListener("beforeunload",function(n){if(e){e.writeGameStats("lost",function(){})}});c(document).ready(function(){i18n.init({useCookie:false,resGetPath:"locales/__lng__/__ns__.json",fallbackLng:"en",customLoad:function(r,q,p,o){if(typeof languages[r.toLowerCase()]!="undefined"){var n=languages[r.toLowerCase()];o(null,n)}else{o("nuts",{})}}},function(o){m=o;c("#toolbar").i18n();l();c("body").css("height",window.innerHeight+"px");var n=function(){c("#tb-menu").removeClass("toggled");c("body").unbind("click")};c("#tb-menu a").click(function(){var p=c(this).parent().toggleClass("toggled");if(p.hasClass("toggled")){c("body").bind("mousedown",function(q){if(c(q.target).closest("#tb-menu").length==0){n()}})}else{n()}});c("#tb-newgame").click(function(){delete k.seed;b(function(){d(k)});n();return false});c("#tb-restartgame").click(function(){var p=e?e.get("seed"):undefined;b(function(){k.seed=p;d(k)});n();return false});c("#tb-about").click(function(){h();n();return false});c("#tb-rules").click(function(){g();n();return false});c("#tb-choosegame").click(function(){b(l);n();return false});c("#tb-undo").click(function(){e.undoMove();return false});c("#tb-hint").click(function(){i.getHint();return false})})})})(jQuery);